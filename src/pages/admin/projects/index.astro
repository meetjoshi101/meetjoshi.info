---
export const prerender = false;
import AdminLayout from '../../../layouts/AdminLayout.astro';
import { getCollection } from 'astro:content';

// Get all projects
const projects = await getCollection('projects');

// Sort by publish date (newest first)
projects.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());
---

<AdminLayout title="Manage Projects | Admin">
  <div class="flex justify-between items-center mb-6">
    <div>
      <h2 class="text-2xl font-bold">Projects</h2>
      <p class="text-base-content/70">Manage your portfolio projects</p>
    </div>
    <a href="/admin/projects/new" class="btn btn-primary">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg>
      New Project
    </a>
  </div>
  
  <!-- Projects list -->
  <div class="overflow-x-auto">
    <table class="table w-full">
      <thead>
        <tr>
          <th>Project</th>
          <th>Technologies</th>
          <th>Added Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {projects.map((project) => (
          <tr>
            <td class="font-medium">
              <div class="flex items-center gap-3">
                {project.data.image && (
                  <div class="avatar">
                    <div class="mask mask-squircle w-12 h-12">
                      <img src={project.data.image} alt={project.data.title} />
                    </div>
                  </div>
                )}
                <div>{project.data.title}</div>
              </div>
            </td>
            <td>
              <div class="flex gap-1 flex-wrap">
                {project.data.technologies.map((tech: string) => (
                  <span class="badge badge-outline">{tech}</span>
                ))}
              </div>
            </td>
            <td>{new Date(project.data.publishDate).toLocaleDateString()}</td>
            <td class="flex gap-2">
              <a href={`/admin/projects/${project.slug}`} class="btn btn-sm btn-outline">
                Edit
              </a>
              <a href={`/projects/${project.slug}`} class="btn btn-sm btn-ghost" target="_blank">
                View
              </a>
            </td>
          </tr>
        ))}
        
        {projects.length === 0 && (
          <tr>
            <td colspan="4" class="text-center py-8">
              <p class="text-base-content/70">No projects found</p>
              <a href="/admin/projects/new" class="btn btn-sm btn-outline mt-4">Add your first project</a>
            </td>
          </tr>
        )}
      </tbody>
    </table>
  </div>
</AdminLayout>
